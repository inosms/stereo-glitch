<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="icon" href="favicon2.png">
    <link rel="apple-touch-icon" href="favicon2.png">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-8Y8CSEP216"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-8Y8CSEP216');
    </script>
    <title>Stereo Glitch Prototype</title>
    <style>
        :root {
            --background-color: hsl(220, 20%, 10%);
        }

        @font-face {
            font-family: "Roboto Regular";
            src: url("Roboto-Regular.ttf") format("truetype");
        }

        @font-face {
            font-family: RobotoMonoRegular;
            src: url("RobotoMono-Regular.ttf") format("truetype");
        }

        #editor {
            .cm-gutters {
                font-family: RobotoMonoRegular;
                background-color: var(--background-color);
                border-right: 1px solid hsl(220, 20%, 20%);

                .cm-activeLineGutter {
                    background-color: rgba(41, 48, 61, 0.5);
                }
            }

            .cm-content {
                font-family: RobotoMonoRegular;
            }

            .cm-selectionBackground {
                background-color: hsl(220, 20%, 30%);
            }

            .cm-activeLine {
                background-color: rgba(41, 48, 61, 0.5);
            }

            .cm-diagnostic {
                background-color: hsl(220, 20%, 30%);
            }

            .cm-tooltip {
                border-color: hsl(220, 20%, 40%);
            }
        }

        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;

            color: hsl(254, 10%, 80%);
            background-color: black;

            /* disable double tap zoom */
            touch-action: manipulation;

            font-family: "Roboto Regular";
        }

        .below-game-container {
            background-color: var(--background-color);

            >.details {
                padding-left: 3%;
                padding-right: 3%;

                @media all and (min-width: 800px) {
                    padding-left: 10%;
                    padding-right: 10%;
                }
            }
        }

        #center-container {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #game {
            font-family: "Roboto Regular";
            display: grid;
            width: 100%;
            max-width: 800px;

            max-height: 100%;
            aspect-ratio: 2/1;

            &.is-mobile {
                grid-template-columns: 12% 76% 12%;
            }

            &:not(.is-mobile) {
                grid-template-columns: 100%;
            }

            >#game-controller-joystick {
                position: relative;
            }

            >#game-controller-action-button {
                position: relative;
            }

            >#game-container {
                width: 100%;

                >canvas {
                    padding-left: 0;
                    padding-right: 0;
                    margin-left: auto;
                    margin-right: auto;
                    display: block;

                    outline: none;
                }
            }
        }

        @media (orientation: landscape) {
            .vertical-center {
                margin: 0;
                position: relative;
                top: 50%;
                -ms-transform: translateY(-0%);
                transform: translateY(-0%);
            }
        }

        /* Praise SO https://stackoverflow.com/questions/826782/how-to-disable-text-selection-highlighting */
        .noselect {
            -webkit-touch-callout: none;
            /* iOS Safari */
            -webkit-user-select: none;
            /* Safari */
            -khtml-user-select: none;
            /* Konqueror HTML */
            -moz-user-select: none;
            /* Old versions of Firefox */
            -ms-user-select: none;
            /* Internet Explorer/Edge */
            user-select: none;
            /* Non-prefixed version, currently
                                  supported by Chrome, Edge, Opera and Firefox */
        }

        .fade {
            height: 100px;
            width: 100%;
            background: rgb(0, 0, 0);
            background: linear-gradient(180deg, rgba(0, 0, 0, 1) 0%, rgba(0, 0, 0, 0) 100%);
        }

        h1 {
            font-family: RobotoMonoRegular;
            font-size: 20px;
            text-align: center;
            padding-top: 20px;
            padding-bottom: 20px;
        }

        h2 {
            font-family: RobotoMonoRegular;
            font-size: 16px;
            text-align: left;
            padding-top: 20px;
            padding-bottom: 20px;
        }

        kbd {
            font-family: RobotoMonoRegular;
            display: inline-block;
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 4px;
            padding: 0.1em 0.4em;
            margin: 0 0.2em;
            box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2), 0 0 0 2px rgba(255, 255, 255, 0.05) inset;
            background-color: rgba(255, 255, 255, 0.1);
        }

        code {
            font-family: RobotoMonoRegular;
            display: inline-block;
            padding: 0.1em 0.4em;
            margin: 0 0.2em;
            color: hsl(143, 67%, 62%);
        }

        p {
            font-size: 16px;
            line-height: 1.5em;
            margin-top: 0;
            margin-bottom: 0.5em;
        }

        a {
            color: hsl(220, 90%, 80%);
        }

        .editor-container {
            >.top-bar {
                display: flex;
                justify-content: space-between;
                align-items: center;

                button {
                    font-family: RobotoMonoRegular;
                    font-size: 16px;
                    color: hsl(254, 10%, 80%);
                    border-radius: 8px;
                    padding: 4px 8px;
                    cursor: pointer;

                    &.is-active {
                        background-color: rgba(0, 255, 110, 0.2);
                        border: 2px solid rgba(0, 255, 110, 0.4);

                        &:hover {
                            background-color: rgba(0, 255, 110, 0.4);
                        }
                    }

                    &:not(.is-active) {
                        background-color: rgba(187, 107, 107, 0.2);
                        border: 2px solid rgba(187, 107, 107, 0.4);

                        &:hover {
                            background-color: rgba(187, 107, 107, 0.4);
                        }
                    }
                }
            }

            padding-top: 20px;
            padding-bottom: 20px;
        }
    </style>
</head>

<body>
    <script type="module" src="script.ts"></script>
    <div id="center-container">
        <div id="game" class="noselect shadow-5 vertical-center">
            <div id="game-controller-joystick"></div>
            <div id="game-container"></div>
            <div id="game-controller-action-button"></div>
        </div>
    </div>
    <div class="below-game-container">
        <div class="fade">
            <h1>STEREO GLITCH</h1>
        </div>
        <div class="details">
            <p>Experimental game written in <a href="https://www.rust-lang.org/">Rust</a> with <a
                    href="https://wgpu.rs/">wgpu</a> compiled to WASM.</p>
            <p>Move with <kbd>W</kbd><kbd>A</kbd><kbd>S</kbd><kbd>D</kbd> and grab with <kbd>Space</kbd>. On mobile use
                the left and right joystick.</p>
            <div class="editor-container">
                <div class="top-bar">
                    <h2>Level Editor</h2>
                    <button id="load-button">Load</button>
                </div>

                <div id="editor"></div>
                <div class="explanation">
                    <p>
                        You can write your own levels here. In order to load your level you have to press the Load
                        button.
                        When successfully loaded your level file will be compressed and added to your URL.
                        If you share this URL you can share the level you created with your friends.
                    </p>
                    <p>
                        The level file is simply a text file describing the level map as seen from above.
                    </p>
                    <p>
                        For stacking blocks on top of each other you can use the <code>+</code> character.
                        For example <code>N+P</code> will create a stack of a normal floor tile with a player on top of
                        it.
                    </p>
                    <p>
                        In order to stack the same block multiple times you can use the <code>x</code> character.
                        For example <code>Nx3</code> will create a stack of 3 normal floor tiles.
                    </p>
                    <p>
                        Creating a glitch area is done by prepending the <code>_</code> character to a stack.
                        For example <code>_N+P</code> will create a glitch area with a normal floor tile and a player on
                        top of it.
                    </p>
                    <p>
                        Every block can be assigned an id by appending the <code>#</code> character followed by an
                        alphanumeric string.
                        These ids can then be referenced by doors by using parentheses.
                        For example <code>T#1</code> will create a trigger with the id <code>1</code>.
                        Using that <code>D(#1)</code> will create a door that opens when the trigger with the id
                        <code>1</code> is activated.
                    </p>
                    <p>
                        There are several restrictions on the level file:
                    <ul>
                        <li>There must only be one player</li>
                        <li>Every id must be unique</li>
                        <li>The level file can not exceed 256 in x, y and z direction</li>
                    </ul>
                    </p>
                </div>
            </div>
        </div>
    </div>
</body>

</html>